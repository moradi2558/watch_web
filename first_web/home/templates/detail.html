{% extends 'main.html' %} {% load static %} {% block title %}detail{% endblock%} {% block body %}
<head>
  {% load bootstrap5 %} {% load jformat %} {% bootstrap_css %} {% bootstrap_javascript %}
  <link rel="stylesheet" href="{% static 'detail.css' %}" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/css/all.min.css"
    integrity="sha512-gMjQeDaELJ0ryCI+FtItusU9MkAifCZcGq789FrzkiM49D8lbDhoaUaIX4ASU187wofMNlgBJ4ckbrXM9sE6Pg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
    crossorigin="anonymous"
  />
  <!-- <link href="{% static 'fontawesomefree/css/fontawesome.css' %}" rel="stylesheet" type="text/css">
   <script src="{% static 'fontawesomefree/js/all.min.js' %}"></script>  -->
</head>
<h1>{{products.name}}</h1>
<h4>rate:{{products.average}}</h4>
<br />
<img
  style="width: 8rem; height: 8rem"
  src="{{products.image.url}}"
  alt=""
/><br />
{% if user.is_authenticated%} فرم سفارش دادن محصول
<div class="card">
  {% if product.status != 'None' %}
  <form method="post" action="{% url 'cart:add_cart' products.id %}">
    {%csrf_token%}
    <input type="hidden" name="select" value="{{variants.id}}" />
    <input
      type="number"
      name="quantity"
      min="1"
      value="1"
      max="{{variants.amount}}"
    />
    <button type="submit">add</button>
  </form>
  {% else %}
  <form method="post" action="{% url 'cart:add_cart' products.id %}">
    {%csrf_token%}
    <input
      type="number"
      name="quantity"
      min="1"
      value="1"
      max="{{product.amount}}"
    />
    <button type="submit">add</button>
  </form>
</div>
{%endif%}{%endif%}
<p>{{products.information|safe}}</p>
<div class="row">
  {% for img in image %}
  <img
    src="{{img.image.url}}"
    alt=""
    style="height: 200px; width: 200px"
  />{%endfor%}
</div>
{% if is_favourite %}
<a href="{% url 'home:favourite' products.id %}">
  <i class="fa fa-heart" style="color : red; font-size: 20px;"></i
></a>
{% else %}
<a href="{% url 'home:favourite' products.id %}">
  <i class="far fa-heart" style="color : red; font-size: 20px;"></i
></a>
{% endif %}
<small>like: {{products.total_like}}</small>
<small>unlike: {{products.total_unlike}}</small>
{% if request.user.is_authenticated %} {% if is_like %}
<a
  href="{% url 'home:product_like'  products.id %}"
  class="btn btn-info {% if is_unlike %}disabled{% endif %}"
  >unlike</a
>
{% else %}
<a
  href="{% url 'home:product_like' products.id %}"
  class="btn btn-info{% if is_unlike %}disabled{% endif %}"
  >like</a
><br />
{% endif %} {% if is_unlike %}
<a
  href="{% url 'home:product_unlike' products.id %}"
  class="btn btn-info{% if is_like %}disabled{% endif %}"
  >like</a
>
{% else %}
<a
  href="{% url 'home:product_unlike' products.id  %}"
  class="btn btn-info{% if is_like %}disabled{% endif %}"
  >dislike</a
><br />
{% endif %} {% endif %} 
{%if products.status == "None"%}
{% if products.discount %}
<h4 class="col-2 bg-info m-2"  style="text-decoration: line-through">your choice price:{{products.unit_price}}</h4>
<h3 class="col-2 bg-info m-2">your choice price:{{products.total_price}}</h3>
{% else %}
<h3 class="col-2 bg-info m-2">your choice price:{{products.total_price}}</h3>
{% endif %}
{%else%}
<div class="col-2 bg-info m-2">your choice price:{{variants.total_price}}</div>
{%endif%}
<hr />

{% if products.status == 'Size' %}
<form action="" method="post">
  {% csrf_token %} {% for data in variant %}<input type="radio" value =
  "{{data.id}}" {% if variants.id == data.id %} checked {% endif %} name =
  'select' onchange = "this.form.submit();">
  <a href=""><small>{{ data.size_variant }}</small> </a>
  {% endfor %}
</form>
{% elif products.status == 'Color' %}
<form action="" method="post">
  {% csrf_token %} {% for data in variant %}<input type="radio" value =
  "{{data.id}}" {% if variants.id == data.id %} checked {% endif %} name =
  'select' onchange = "this.form.submit();">
  <a href=""><small>{{ data.color_variant }}</small> </a>

  {% endfor %} {% endif %}
</form>

<hr />
<br />

<hr />
<br />
<hr />

{% block scripts %}
<div>
  <canvas id="myChart" class="bg-secondary-subtle"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% if products.status == 'None' %}
<script>
var ctx3 = document.getElementById('myChart');

  new Chart(ctx3, {
    type: 'line',
    data: {
      labels: [{% for i in update %}'{{i.update|jformat:"%A %d %B %Y"}}',{% endfor %}],
      datasets: [{
        label: '# of Votes',
        data: [{% for i in update %}{{i.unit_price}},{% endfor %}],
        borderWidth: 4,
        backgroundColor: '#1F618D',
        borderColor:'#1F618D',
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      },
  }
});
</script>
{% else %}
<!-- {% for i in update %}'{{i.update|jformat:"%A %d %B %Y"}}',{% endfor %} -->
<!-- {% for i in update %}{{i.unit_price}},{% endfor %} -->
<script>
  var ctx2 = document.getElementById('myChart');

  new Chart(ctx2, {
    type: 'line',
    data: {
      labels: [{% for i in change %}{% if variants.id == i.variant_id %}'{{i.update|jformat:"%A %d %B %Y"}}'{% endif%},{% endfor %}],
      datasets: [{
        label: '# of Votes',
        data: [{% for i in change %}{% if variants.id == i.variant_id %}{{i.unit_price}}{% endif %},{% endfor %}],
        borderWidth: 4,
        backgroundColor: '#1F618D',
        borderColor:'#1F618D'
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endif %}
{%endblock%}

<h2 class="fw-bolder fs-2 m-4 ms-5">Comment User</h2>
{%for com in comment %}
<div class="p-2 container d-flex flex-column align-items-start">
  <div
    class="d-flex p-3 rounded-3 col-8 justify-content-start flex-wrap"
    style="background-color: black; width: 50vw"
  >
    <div class="col-2 align-self-center">
      <img
        src="{{profile.profile_image.url}}"
        alt=""
        style="width: 5rem; height: 5rem; border: 1px solid black"
        class="rounded-circle img-fluid"
      />
    </div>
    <div class="col-8 d-flex flex-column justify-content-between">
      <p class="text-white fs-4 fw-bold m-0">{{com.user.username}}</p>
      <p class="text-white mt-1 mb-2">{{com.comment}}</p>
      <div class="comment-rating">
        <i
          class="fa fa-star {% if com.rate < 1 %}text-secondary{% else %} text-warning {% endif %}"
        ></i>
        <i
          class="fa fa-star {% if com.rate < 2 %}text-secondary{% else %} text-warning {% endif %}"
        ></i>
        <i
          class="fa fa-star {% if com.rate < 3 %}text-secondary{% else %} text-warning {% endif %}"
        ></i>
        <i
          class="fa fa-star {% if com.rate < 4 %}text-secondary{% else %} text-warning {% endif %}"
        ></i>
        <i
          class="fa fa-star {% if com.rate < 5 %}text-secondary{% else %} text-warning {% endif %}"
        ></i>
      </div>
    </div>
    {% if user.is_authenticated %}
    <div class="col-2 d-flex align-items-center justify-content-around">
      <i class="fa fa-reply fs-3 text-white btn-reply"></i>
      <a
        href="{% url 'home:comment_like' com.id %}"
        style="text-decoration: none"
        ><i class="fa fa-heart fs-3 white ms-3 heart"></i>
      </a>
      <span style="color: white" class="fw-2 fs-4 mx-1"
        >{{com.total_like_comment}}</span
      >
    </div>
    {% endif %}
    <div class="mt-5 mb-3 col-12 d-flex replys">
      <div class="col-10">
        {%for data in com.comment_reply.all %}
        <p
          class="text-light bg-secondary p-3 ps-4 rounded-4 reps"
          style="display: none"
        >
          {{data.comment}}
        </p>
        {% endfor %}
      </div>
      <i
        class="fas fa-plus text-light mt-3 offset-1 show-more"
        style="cursor: pointer"
      ></i>
    </div>
    <div class="col-12 reply" style="display: none">
      <form
        method="post"
        action="{%url 'home:product_reply' products.id com.id %}"
      >
        {%csrf_token%}
        <textarea
          style="
            background-color: rgb(44, 48, 48);
            color: white;
            border: 0;
            outline: 0;
          "
          spellcheck="false"
          name="comment"
          id="comment"
          class="form_control col-12 pt-2 ps-2 rounded-3 mt-3"
          rows="4"
          placeholder="reply ..."
          required
        ></textarea>
        <div class="mt-3">
          <button type="submit" class="btn btn-outline-light">
            send reply
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{%endfor%}
<h2 class="fw-bolder fs-2 m-4 ms-5">Add Comment</h2>
{% if user.is_authenticated%}
<div class="mb-5">
  <form method="post" action="{% url 'home:product_comment' products.id %}">
    {%csrf_token%}
    <div class="container d-flex flex-column align-items-center">
      <div class="star-wrapper rate mb-2">
        <input type="radio" name="rate" value="5" id="5" /><label for="5"
          ><i class="fas fa-star s5"></i
        ></label>
        <input type="radio" name="rate" value="4" id="4" /><label for="4"
          ><i class="fas fa-star s4"></i
        ></label>
        <input type="radio" name="rate" value="3" id="3" /><label for="3"
          ><i class="fas fa-star s3"></i
        ></label>
        <input type="radio" name="rate" value="2" id="2" /><label for="2"
          ><i class="fas fa-star s2"></i
        ></label>
        <input type="radio" name="rate" value="1" id="1" /><label for="1"
          ><i class="fas fa-star s1"></i
        ></label>
      </div>
      <div class="mt-2">
        <textarea
          name="comment"
          class="comment p-3 border-1"
          spellcheck="false"
          placeholder="Add comment..."
          cols="40"
          rows="5"
        ></textarea>
      </div>
      <button class="btne third" type="submit">send comment</button>
    </div>
  </form>
</div>
{%endif%}
<h1>similar products</h1>
{% for tag in similar %}
<a href="{% url 'home:detail'  tag.id %}">
  <img src="{{tag.image.url}}" alt="" style="width: 50px; height: 50px" />
</a>
{% endfor %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'script.js' %}"></script>
{% endblock %}
